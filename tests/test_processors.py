from wirecode import processors, plans, plan_to_string, string_to_plan


plan_in = """G01 X+0009.89949494 Y-0002.82842712
G01 X+0007.07106781 Y+0000.00000000
G01 X+0006.36396103 Y+0000.70710678 (INT)
G01 X+0005.65685425 Y+0001.41421356 (INT)
G01 X+0004.94974747 Y+0002.12132034 (INT)
G01 X+0004.24264069 Y+0002.82842712 (INT)
G01 X+0003.53553391 Y+0003.53553391 (INT)
G01 X+0002.82842712 Y+0004.24264069 (INT)
G01 X+0002.12132034 Y+0004.94974747 (INT)
G01 X+0001.41421356 Y+0005.65685425 (INT)
G01 X+0000.70710678 Y+0006.36396103 (INT)
G01 X+0000.00000000 Y+0007.07106781 (INT)
G01 X-0002.82842712 Y+0009.89949494
G01 X+0002.82842712 Y+0009.89949494
G01 X+0000.00000000 Y+0007.07106781
G01 X-0000.70710678 Y+0006.36396103 (INT)
G01 X-0001.41421356 Y+0005.65685425 (INT)
G01 X-0002.12132034 Y+0004.94974747 (INT)
G01 X-0002.82842712 Y+0004.24264069 (INT)
G01 X-0003.53553391 Y+0003.53553391 (INT)
G01 X-0004.24264069 Y+0002.82842712 (INT)
G01 X-0004.94974747 Y+0002.12132034 (INT)
G01 X-0005.65685425 Y+0001.41421356 (INT)
G01 X-0006.36396103 Y+0000.70710678 (INT)
G01 X-0007.07106781 Y+0000.00000000 (INT)
G01 X-0009.89949494 Y-0002.82842712
G01 X-0009.89949494 Y+0002.82842712
G01 X-0007.07106781 Y+0000.00000000
G01 X-0006.36396103 Y-0000.70710678 (INT)
G01 X-0005.65685425 Y-0001.41421356 (INT)
G01 X-0004.94974747 Y-0002.12132034 (INT)
G01 X-0004.24264069 Y-0002.82842712 (INT)
G01 X-0003.53553391 Y-0003.53553391 (INT)
G01 X-0002.82842712 Y-0004.24264069 (INT)
G01 X-0002.12132034 Y-0004.94974747 (INT)
G01 X-0001.41421356 Y-0005.65685425 (INT)
G01 X-0000.70710678 Y-0006.36396103 (INT)
G01 X-0000.00000000 Y-0007.07106781 (INT)
G01 X+0002.82842712 Y-0009.89949494
G01 X-0002.82842712 Y-0009.89949494
G01 X-0000.00000000 Y-0007.07106781
G01 X+0000.70710678 Y-0006.36396103 (INT)
G01 X+0001.41421356 Y-0005.65685425 (INT)
G01 X+0002.12132034 Y-0004.94974747 (INT)
G01 X+0002.82842712 Y-0004.24264069 (INT)
G01 X+0003.53553391 Y-0003.53553391 (INT)
G01 X+0004.24264069 Y-0002.82842712 (INT)
G01 X+0004.94974747 Y-0002.12132034 (INT)
G01 X+0005.65685425 Y-0001.41421356 (INT)
G01 X+0006.36396103 Y-0000.70710678 (INT)
G01 X+0007.07106781 Y-0000.00000000 (INT)
G01 X+0009.89949494 Y+0002.82842712"""

plan_out = """G01 X+0009.89949494 Y-0002.82842712  
G01 X+0007.07106781 Y+0000.00000000
G01 X+0006.71751442 Y+0000.35355339 S1000
G01 X+0006.36396103 Y+0000.70710678 S0000
G01 X+0006.01040764 Y+0001.06066017 S1000
G01 X+0005.65685425 Y+0001.41421356 S0000
G01 X+0005.30330086 Y+0001.76776695 S1000
G01 X+0004.94974747 Y+0002.12132034 S0000
G01 X+0004.59619408 Y+0002.47487373 S1000
G01 X+0004.24264069 Y+0002.82842712 S0000
G01 X+0003.88908730 Y+0003.18198052 S1000
G01 X+0003.53553391 Y+0003.53553391 S0000
G01 X+0003.18198052 Y+0003.88908730 S1000
G01 X+0002.82842712 Y+0004.24264069 S0000
G01 X+0002.47487373 Y+0004.59619408 S1000
G01 X+0002.12132034 Y+0004.94974747 S0000
G01 X+0001.76776695 Y+0005.30330086 S1000
G01 X+0001.41421356 Y+0005.65685425 S0000
G01 X+0001.06066017 Y+0006.01040764 S1000
G01 X+0000.70710678 Y+0006.36396103 S0000
G01 X+0000.35355339 Y+0006.71751442 S1000
G01 X+0000.00000000 Y+0007.07106781 S0000
G01 X-0001.41421356 Y+0008.48528137 S1000
G01 X-0002.82842712 Y+0009.89949494 S0000
G01 X+0002.82842712 Y+0009.89949494  
G01 X+0000.00000000 Y+0007.07106781
G01 X-0000.35355339 Y+0006.71751442 S1000
G01 X-0000.70710678 Y+0006.36396103 S0000
G01 X-0001.06066017 Y+0006.01040764 S1000
G01 X-0001.41421356 Y+0005.65685425 S0000
G01 X-0001.76776695 Y+0005.30330086 S1000
G01 X-0002.12132034 Y+0004.94974747 S0000
G01 X-0002.47487373 Y+0004.59619408 S1000
G01 X-0002.82842712 Y+0004.24264069 S0000
G01 X-0003.18198052 Y+0003.88908730 S1000
G01 X-0003.53553391 Y+0003.53553391 S0000
G01 X-0003.88908730 Y+0003.18198052 S1000
G01 X-0004.24264069 Y+0002.82842712 S0000
G01 X-0004.59619408 Y+0002.47487373 S1000
G01 X-0004.94974747 Y+0002.12132034 S0000
G01 X-0005.30330086 Y+0001.76776695 S1000
G01 X-0005.65685425 Y+0001.41421356 S0000
G01 X-0006.01040764 Y+0001.06066017 S1000
G01 X-0006.36396103 Y+0000.70710678 S0000
G01 X-0006.71751442 Y+0000.35355339 S1000
G01 X-0007.07106781 Y+0000.00000000 S0000
G01 X-0008.48528137 Y-0001.41421356 S1000
G01 X-0009.89949494 Y-0002.82842712 S0000
G01 X-0009.89949494 Y+0002.82842712  
G01 X-0007.07106781 Y+0000.00000000 
G01 X-0006.71751442 Y-0000.35355339 S1000
G01 X-0006.36396103 Y-0000.70710678 S0000
G01 X-0006.01040764 Y-0001.06066017 S1000
G01 X-0005.65685425 Y-0001.41421356 S0000
G01 X-0005.30330086 Y-0001.76776695 S1000
G01 X-0004.94974747 Y-0002.12132034 S0000
G01 X-0004.59619408 Y-0002.47487373 S1000
G01 X-0004.24264069 Y-0002.82842712 S0000
G01 X-0003.88908730 Y-0003.18198052 S1000
G01 X-0003.53553391 Y-0003.53553391 S0000
G01 X-0003.18198052 Y-0003.88908730 S1000
G01 X-0002.82842712 Y-0004.24264069 S0000
G01 X-0002.47487373 Y-0004.59619408 S1000
G01 X-0002.12132034 Y-0004.94974747 S0000
G01 X-0001.76776695 Y-0005.30330086 S1000
G01 X-0001.41421356 Y-0005.65685425 S0000
G01 X-0001.06066017 Y-0006.01040764 S1000
G01 X-0000.70710678 Y-0006.36396103 S0000
G01 X-0000.35355339 Y-0006.71751442 S1000
G01 X-0000.00000000 Y-0007.07106781 S0000
G01 X+0001.41421356 Y-0008.48528137 S1000
G01 X+0002.82842712 Y-0009.89949494 S0000
G01 X-0002.82842712 Y-0009.89949494  
G01 X-0000.00000000 Y-0007.07106781 
G01 X+0000.35355339 Y-0006.71751442 S1000
G01 X+0000.70710678 Y-0006.36396103 S0000
G01 X+0001.06066017 Y-0006.01040764 S1000
G01 X+0001.41421356 Y-0005.65685425 S0000
G01 X+0001.76776695 Y-0005.30330086 S1000
G01 X+0002.12132034 Y-0004.94974747 S0000
G01 X+0002.47487373 Y-0004.59619408 S1000
G01 X+0002.82842712 Y-0004.24264069 S0000
G01 X+0003.18198052 Y-0003.88908730 S1000
G01 X+0003.53553391 Y-0003.53553391 S0000
G01 X+0003.88908730 Y-0003.18198052 S1000
G01 X+0004.24264069 Y-0002.82842712 S0000
G01 X+0004.59619408 Y-0002.47487373 S1000
G01 X+0004.94974747 Y-0002.12132034 S0000
G01 X+0005.30330086 Y-0001.76776695 S1000
G01 X+0005.65685425 Y-0001.41421356 S0000
G01 X+0006.01040764 Y-0001.06066017 S1000
G01 X+0006.36396103 Y-0000.70710678 S0000
G01 X+0006.71751442 Y-0000.35355339 S1000
G01 X+0007.07106781 Y-0000.00000000 S0000
G01 X+0008.48528137 Y+0001.41421356 S1000
G01 X+0009.89949494 Y+0002.82842712 S0000"""


def test_preprocess_integration():
    before_processing = string_to_plan(plan_in)
    after_processing = processors.preprocess_integration_gcode(before_processing)
    desired_result = string_to_plan(plan_out)
    assert after_processing == desired_result
